## Виртуальная машина

### Задание

В данном задании требуется написать виртуальную машину, исполняющую байткод питона. На питоне.

Мы подготовили для вас небольшой каркас. Реализация виртуальной машины находится в файле `vm.py`, там написан базовый код для прохождения одного тест-кейса `test_public.py::test_all_cases[simple]`. Вам нужно переписать/расширить код так, чтоб он проходил максимальное число тестов. Другие файлы менять не надо.

**Важно!** Код каркаса можно и нужно менять как угодно, за исключением интерфейса метода `run` класса `VirtualMachine` -- именно он вызывается в тестах.

### Замечания

* Задание намеренно не содержит полной спецификации работы виртуальной машины. Ваша задача самостоятельно разобраться в том, как происходит работа со стеком при исполнении байткода.
* Не стесняйтесь гуглить, читать и обсуждать между собой непонятные вопросы. В интернете много детальных разборов этой темы.
* Обратите внимание что в общем README есть инструкция как запустить определённые тесты прямо из PyCharm.

### Как запустить конкретный тест-кейс

Обратите внимание на закомментированный код в файле `vm_runner.py`, он поможет вам при дебаге.

```bash
$ pytest test_public.py::test_all_cases[simple] -vvv
```
Для тех у кого `zsh`
```bash
$ pytest test_public.py::test_all_cases\[simple\] -vvv
```

### Как запустить все тесты

```bash
$ pytest test_public.py -vvv --tb=no
```

### Как посмотреть распределение операций по тестам

```bash
$ pytest test_stat.py -s
```

### Как посмотреть суммарный балл локально

```bash
$ pytest test_public.py -s --tb=no
```

Текущий балл (`Full score is: 100500`) будет строчкой перед `== short test summary info ==`

### Запрещено

Нельзя использовать в реализации **exec**, **eval**, **inspect**, **FunctionType**.
Также нельзя писать реализацию функций подменой `__code__`:
```
        def f():
            pass
        f.__code__ = code
        f()
```
Это обусловлено тем, что таким образом вы вызываете интерпретатор питона, а не пишете свой.
А задание именно в том, чтоб написать его самим.


### Очень полезные ссылки

* Документация к dis: https://docs.python.org/release/3.12.5/library/dis.html#module-dis. Там описаны все существующие операции байткода питона.
* Академический проект интерпретатора для PY27 и PY33, снабженный множеством комментариев, но не лишенный проблем: https://github.com/nedbat/byterun.
Его детальное обсуждение в блоге: http://www.aosabook.org/en/500L/a-python-interpreter-written-in-python.html.
* Исходный код интерпретатора CPython - поможет разобраться с тонкостями:
  - https://github.com/python/cpython/blob/3.12/Python/ceval.c.
  - https://github.com/python/cpython/blob/3.12/Python/generated_cases.c.h
